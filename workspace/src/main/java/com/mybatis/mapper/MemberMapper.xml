<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="member">
	<!-- 회원 삽입 -->
	<insert id="memberJoin" parameterType="MemberDTO">
		INSERT INTO DT_MEMBER
		(MEMBER_NUMBER, MEMBER_ID, MEMBER_PW, MEMBER_NAME,
		MEMBER_BIRTH,
		MEMBER_PHONE, ADDRESS_NUMBER)
		VALUES (MEMBER_SEQ.NEXTVAL, #{memberId}, #{memberPw},
		#{memberName},
		TO_DATE(#{memberBirth}, 'YYYY-MM-DD'), #{memberPhone}, #{addressNumber})
	</insert>

	<!-- 주소테이블에 마지막으로 생성된 PK조회. 다음테이블에 참조값으로 쓰기위해 사용 -->
	<select id="getAddressFK" resultType="Integer">
		SELECT ADDRESS_NUMBER
		FROM (
		SELECT ADDRESS_NUMBER
		FROM DT_ADDRESS
		ORDER BY ADDRESS_NUMBER DESC
		)
		WHERE ROWNUM = 1
	</select>

	<!-- 주소 삽입 -->
	<insert id="memberAddress" parameterType="MemberDTO">
		INSERT INTO DT_ADDRESS
		(ADDRESS_NUMBER, ADDRESS_POSTAL, ADDRESS_ADDRESS,
		ADDRESS_DETAIL)
		VALUES (ADDRESS_SEQ.NEXTVAL, #{addressPostal}, #{addressAddress},
		#{addressDetail})
	</insert>


	<select id="memberLogin" parameterType="MemberDTO"
		resultType="memberDTO">
		SELECT d.member_number,
		d.doctor_id,
		d.doctor_pw,
		d.doctor_name,
		d.doctor_phone,
		a.address_number,
		a.address_postal,
		a.address_address,
		a.address_detail
		from dt_doctor d
		where d.member_id = #{memberId} and
		d.member_pw = #{memberPw}
	</select>

	<!-- 회원탈퇴 -->
	<delete id="quit" parameterType="Integer">
		delete from dt_doctor
		where
		member_number = #{memberNumber}
	</delete>

</mapper>
