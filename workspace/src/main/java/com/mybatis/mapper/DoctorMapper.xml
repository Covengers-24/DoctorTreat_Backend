<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="doctor">

	<!-- 의료 회원가입 -->

	<!-- 주소 삽입 -->
	<insert id="doctorJoinAddress" parameterType="DoctorDTO">
		<!-- useGeneratedKeys="true" keyProperty="addressNumber"> -->
		INSERT INTO DT_ADDRESS
		(ADDRESS_NUMBER, ADDRESS_POSTAL, ADDRESS_ADDRESS,
		ADDRESS_DETAIL)
		VALUES (ADDRESS_SEQ.NEXTVAL, #{addressPostal}, #{addressAddress},
		#{addressDetail})
	</insert>

	<!-- 주소테이블에 마지막으로 생성된 PK조회. 다음테이블에 참조값으로 쓰기위해 사용 -->
	<select id="getAddressNum" resultType="Integer">
		SELECT ADDRESS_NUMBER
		FROM (
		SELECT ADDRESS_NUMBER
		FROM DT_ADDRESS
		ORDER BY ADDRESS_NUMBER DESC
		)
		WHERE ROWNUM = 1
	</select>

	<!-- 병원 삽입 -->
	<insert id="doctorJoinHospital" parameterType="DoctorDTO">
		<!-- useGeneratedKeys="true" keyProperty="hospitalNumber"> -->
		INSERT INTO
		DT_HOSPITAL
		(HOSPITAL_NUMBER, HOSPITAL_CALL, HOSPITAL_NAME,
		ADDRESS_NUMBER)
		VALUES
		(HOSPITAL_SEQ.NEXTVAL, #{hospitalCall},
		#{hospitalName},
		#{addressNumber})
	</insert>

	<!-- 병원테이블에 마지막으로 생성된 PK조회. 다음테이블에 참조값으로 쓰기위해 사용 -->
	<select id="getHospitalNum" resultType="Integer">
		SELECT HOSPITAL_NUMBER
		FROM (
		SELECT HOSPITAL_NUMBER
		FROM DT_HOSPITAL
		ORDER BY HOSPITAL_NUMBER DESC
		)
		WHERE ROWNUM = 1
	</select>

	<!-- 의사 삽입 -->
	<insert id="doctorJoin" parameterType="DoctorDTO">
		<!-- useGeneratedKeys="true" keyProperty="doctorNumber">  -->
		INSERT INTO DT_DOCTOR
		(DOCTOR_NUMBER, DOCTOR_ID, DOCTOR_PW, DOCTOR_NAME,
		DOCTOR_PHONE,
		DOCTOR_LICENSE, DOCTOR_MAJOR, HOSPITAL_NUMBER)
		VALUES
		(DOCTOR_SEQ.NEXTVAL, #{doctorId}, #{doctorPw}, #{doctorName},
		#{doctorPhone}, #{doctorLicense}, #{doctorMajor},
		#{hospitalNumber})
	</insert>

</mapper>
